env: dev
debug: true

# 服务器配置
server:
  api:
    port: 8610
    read_timeout: 60
    write_timeout: 60
    # JWT配置
    jwt:
      secret: "" # Configured via GREENRIDE_SERVER_API_JWT_SECRET
      expiration: "24h"
      issuer: "Greenride"
      audience: "greenride-users"
  admin:
    port: 8611
    read_timeout: 60
    write_timeout: 60
    # JWT配置
    jwt:
      secret: "" # Configured via GREENRIDE_SERVER_ADMIN_JWT_SECRET
      expiration: "24h"
      issuer: "Greenride"
      audience: "greenride-admin"
# 数据库配置
database:
  #dev
  dsn: "greenride:GreenRide2024!@tcp(localhost:3306)/greenride?charset=utf8mb4&parseTime=True&loc=Local"
  #prod
  #dsn: "" 
  max_idle_conns: 5
  max_open_conns: 25
  conn_max_lifetime: "300s"
  conn_max_idle_time: "600s"
  debug: true

# Redis配置
redis:
  dsn: "redis://localhost:6379"

# 日志配置
log:
  path: "logs"
  level: "info"
  format: "json"
  output: "both"  # stdout, file, both

# 国际化配置
i18n:
  locales_dir: "internal/locales"  # 本地开发环境路径
  default_language: "en"
  supported_langs: ["en", "fr", "rw"]

google:
  maps_api_key: "" # Configured via GREENRIDE_GOOGLE_MAPS_API_KEY

task:
  enabled: true

# Firebase配置 (使用YAML格式)
firebase:
  type: "service_account"
  project_id: ""
  private_key_id: ""
  private_key: ""
  client_email: ""
  client_id: ""
  auth_uri: "https://accounts.google.com/o/oauth2/auth"
  token_uri: "https://oauth2.googleapis.com/token"
  auth_provider_x509_cert_url: "https://www.googleapis.com/oauth2/v1/certs"
  client_x509_cert_url: ""
  universe_domain: "googleapis.com"

# AWS配置
aws:
  # S3存储配置
  s3_region: "ap-southeast-2"
  s3_bucket: "greenride-test"
  
  # 可选：如果配置了CloudFront CDN
  cloudfront_url: ""

# 邮件配置
email:
  # 服务类型：account
  service_name: "account"
  sender: "notification@lunotravel.com"
  # 自建邮箱账户配置（当 service_name 为 account 时使用）
  accounts:
    # 飞书邮箱账户 - 最高优先级
    - name: "feishu"
      host: "smtp.feishu.cn"
      port: 465  # SSL 端口
      username: ""  
      password: ""  
      from: "notification@lunotravel.com"
      ssl: true  # 使用 SSL 连接
      priority: 1
      enabled: true

# SMS配置
sms:
  # 服务类型：twilio, 后续可扩展其他服务商
  service_name: "twilio"
  
# Twilio配置
twilio:
  # Twilio账户配置（支持多账号，可用于不同区域或业务线）
  accounts:
    # 主账号 - 用于默认发送
    - name: "primary"
      account_sid: ""
      auth_token: ""
      # 发送号码列表（可配置多个号码，用于不同类型消息或轮换发送）
      phones:
        - "+18447401619"  
      priority: 1  # 优先级，数字越小优先级越高
      enabled: true
# 验证码配置
verify_code:
  length: 4          # 验证码长度
  expiration: 5      # 过期时间（分钟）
  send_interval: 60  # 发送间隔（秒）
  max_send_times: 10 # 每日最大发送次数

# 派单系统配置
dispatch:
  # 基础配置
  enabled: true
  # 司机筛选配置
  driver_selection:
    fetch_all_online: true      # 获取所有在线司机，不管有单无单
    max_candidates: 100         # 最大候选司机数量
    use_geolocation: false      # 是否启用地理位置限制
    
  # 时间窗口分析配置（统一处理空闲和有单司机）
  time_window:
    enabled: true
    # 时间窗口计算参数
    time_buffer_minutes: 5              # 时间缓冲，分钟
    eta_calculation_method: "haversine" # ETA计算方法
    # 有单司机判断标准
    max_additional_distance_km: 2.0     # 最大额外距离，公里
    max_additional_time_minutes: 10     # 最大额外时间，分钟
      
  # 多因子评分配置
  scoring:
    enabled: true
    normalize_scores: true  # 是否标准化评分到[0,1]范围，确保各因子权重公平
    # 评分因子权重（动态调整，空闲司机某些因子权重为0）
    factors:
      rating: 0.25                    # 司机评分权重
      accept_rate: 0.25               # 接单率权重  
      distance: 0.30                  # 距离权重（空闲司机）
      eta_to_pickup: 0.20             # 到达上车点ETA权重
      current_order_eta: 0.15         # 当前订单完成ETA权重（仅有单司机）
      route_compatibility: 0.10       # 路线兼容性权重（仅有单司机）
      
  # 派单轮次配置
  rounds:
    max_rounds: 1                   # 默认最大1轮
    drivers_per_round: 0            # 每轮派发司机数，0表示全部
    response_timeout_seconds: 30
    round_interval_seconds: 60      # 轮次间隔（多轮时有效）

